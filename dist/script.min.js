"use strict";const c=console.log;if("serviceWorker"in navigator){navigator.serviceWorker.register("service-worker.js").then(reg=>console.log("service worker registered",reg)).catch(err=>console.log("service worker not registered",err))}let permission=Notification.permission;if(permission==="granted"){showNotification()}else if(permission==="default"){requestAndShowPermission()}function showNotification(title,message){if(document.visibilityState==="visible"){return}const icon="icon.png";const body=message;const notification=new Notification(title,{body:body,icon:icon});notification.onclick=()=>{notification.close();window.parent.focus()}}function requestAndShowPermission(){Notification.requestPermission(function(permission){if(permission==="granted"){showNotification()}})}const pomodoro=document.querySelector(".pomodoro");const shortBreak=document.querySelector(".shortBreak");const longBreak=document.querySelector(".longBreak");const displayTimeField=document.querySelector(".timer h1");const startBtn=document.querySelector(".start");const options=[...document.querySelector(".options").children];const changeOptionModal=document.querySelector(".changeOption");const closeModal=document.querySelector(".changeOption > div .close");const changeOptionOkBtn=document.querySelector(".changeOption > div .ok");const changeOptionCancelBtn=document.querySelector(".changeOption > div .cancel");const resetSettingsModal=document.querySelector(".resetSettings");const resetSettingsOkBtn=document.querySelector(".resetSettings > div .ok");const resetSettingsCancelBtn=document.querySelector(".resetSettings > div .cancel");const settings=document.querySelector(".settings");const settingsModal=document.querySelector(".settings-container");const settingOpen=document.querySelector(".settings_open");const settingsClose=document.querySelector(".settings-container .close");const settingsSave=document.querySelector(".settings-container .apply");const settingsReset=document.querySelector(".settings-container .reset");const pomodoroTimeValue=document.querySelector(".settings .pomodoro_time");const shortBreakTimeValue=document.querySelector(".settings .shortBreak_time");const longBreakTimeValue=document.querySelector(".settings .longBreak_time");const longBreakTimeInterval=document.querySelector(".longBreak_interval");const autoStartPomodoros=document.querySelector(".autoStartPomodoros");const autoStartBreaks=document.querySelector(".autoStartBreaks");const darkMode=document.querySelector(".darkMode");const themeColorsContainer=document.querySelector(".themeColors");const themesChooser=document.querySelector(".theme_settings .themes");const themeColors=document.querySelector(".themeColors .themes");const pomodoroTheme=document.querySelector(".pomodoro_theme");const shortBreakTheme=document.querySelector(".shortBreak_theme");const longBreakTheme=document.querySelector(".longBreak_theme");const currentOptionIndicator=document.querySelector(".themeColors .current_option");const clickSound=document.getElementById("clickSound");const fastTickingSound=document.getElementById("fastTickingSound");const slowTickingSound=document.getElementById("slowTickingSound");const alarmSoundsDropDown=document.querySelector(".alarm_sounds .dropdown__header");const alarmSounds=document.querySelector(".alarm_sounds .dropdown__body");const alarmRepetition=document.querySelector(".alarm_repetition");const tickingSoundsDropDown=document.querySelector(".ticking_sounds .dropdown__header");const tickingSounds=document.querySelector(".ticking_sounds .dropdown__body");const defaultAlarm=document.getElementById("beepAlarmSound");const defaultTicking=document.getElementById("slowTickingSound");let time,timeAtPause,startInterval,autoStartBreaksCheck,autoStartPomodorosCheck,darkModeCheck,currentOption,selectedSound,selectedAlarmSound,selectedTickingSound,pauseAudio,initialTime;let longBreakTimeIntervalValue=+longBreakTimeInterval.value;let pomodoroCount=0;let currentStatus="focus";let displayTimeOnTitle=document.head.querySelector("title");let selectedAlarmSoundName="Beep";let selectedTickingSoundName="Slow Ticking";const timerThemes={pomodoro:{theme:"pomodoro_theme",color:"#ba4949"},shortBreak:{theme:"shortBreak_theme",color:"#7d53a2"},longBreak:{theme:"longBreak_theme",color:"#38858a"}};localStorage.getItem("settings")?getSettings():getDefaultSettings();if(localStorage.getItem("currentOption")=="pomodoro"||!localStorage.getItem("currentOption")){document.querySelector(".pomodoro").classList.add("active")}else if(localStorage.getItem("currentOption")=="shortBreak"){currentStatus="shortBreak";document.querySelector(".shortBreak").classList.add("active")}else{currentStatus="longBreak";document.querySelector(".longBreak").classList.add("active")}if(localStorage.getItem("timerThemes")){const savedTimerThemes=JSON.parse(localStorage.getItem("timerThemes"));for(const theme in savedTimerThemes){timerThemes[theme]=savedTimerThemes[theme]}}dropDownFunc(alarmSoundsDropDown,alarmSounds);dropDownFunc(tickingSoundsDropDown,tickingSounds);displayTimeAndMsg();function startTimer(duration){let timer,minutes,seconds;timer=duration*60;const timerFunction=()=>{minutes=parseInt(timer/60,10);seconds=parseInt(timer%60,10);minutes=minutes<10?`0${minutes}`:minutes;seconds=seconds<10?`0${seconds}`:seconds;displayTimeField.textContent=`${minutes}:${seconds}`;displayTimeOnTitle.textContent=`${minutes}:${seconds} - ${getStatus()}`;timeAtPause=timer;const percentage=timer/(initialTime*60)*100;document.documentElement.style.setProperty("--progressBarWidth",`${percentage}%`);if(--timer<0){clearInterval(startInterval);setClassAndTexContent("start",startBtn);if(currentStatus=="focus"){let whichBreak;pomodoroCount++;pomodoroCount==longBreakTimeIntervalValue?(whichBreak=".longBreak",pomodoroCount=0):(whichBreak=".shortBreak",pomodoroCount=pomodoroCount);document.querySelector(whichBreak).dispatchEvent(new Event("click"));let repeatCount=+alarmRepetition.value;selectedAlarmSound.addEventListener("ended",function(){if(repeatCount>0){repeatCount--;this.currentTime=0;this.play()}else{repeatCount--}});selectedAlarmSound.play();if(autoStartBreaksCheck){selectedAlarmSound.addEventListener("ended",()=>{if(repeatCount===-1)startBtn.dispatchEvent(new Event("click"))})}selectedTickingSound.pause();showNotification("Time's up!","Time's up! Take a break!")}else{document.querySelector(".pomodoro").dispatchEvent(new Event("click"));if(autoStartPomodorosCheck)startBtn.dispatchEvent(new Event("click"));showNotification("Time to focus!","Break time is over! Focus now!")}}};timerFunction();startInterval=setInterval(timerFunction,1e3)}function displayTimeAndMsg(){currentOption=options.find(e=>e.classList.contains("active"));localStorage.setItem("currentOption",currentOption.classList[0]);initialTime=time=currentOption.dataset.time;const minutesAndSeconds=`${time<10?"0":""}${time}:00`;const secondsOnly=`00:${time*60<10?"0":""}${time*60}`;displayTimeField.textContent=time>=1?minutesAndSeconds:secondsOnly;displayTimeOnTitle.textContent=`${time>=1?minutesAndSeconds:secondsOnly} - ${getStatus()}`;document.documentElement.style.setProperty("--theme",timerThemes[currentOption.classList[0]].color)}function getStatus(){let message;currentStatus=="focus"?message="Time to focus!":currentStatus=="shortBreak"?message="Time for a short break!":message="Time for a long break!";return message}const setClassAndTexContent=(action,button)=>{button.textContent=action.toUpperCase();button.className=action};function chooseOption(el){options.forEach(e=>e.className=e.classList[0]);el.classList.add("active");currentStatus=el.classList[0]=="pomodoro"?"focus":currentStatus=el.classList[0]=="shortBreak"?"shortBreak":"longBreak";clearInterval(startInterval);setClassAndTexContent("start",startBtn);displayTimeAndMsg();document.documentElement.style.setProperty("--progressBarWidth",`100%`);selectedAlarmSound?selectedAlarmSound.pause():""}function getSettings(){const settings=JSON.parse(localStorage.getItem("settings"));pomodoroTimeValue.value=pomodoro.dataset.time=settings.pomodoro;shortBreakTimeValue.value=shortBreak.dataset.time=settings.shortBreak;longBreakTimeValue.value=longBreak.dataset.time=settings.longBreak;autoStartPomodoros.checked=autoStartPomodorosCheck=settings.autoStartPomodoros;autoStartBreaks.checked=autoStartBreaksCheck=settings.autoStartBreaks;darkMode.checked=darkModeCheck=settings.darkMode;longBreakTimeInterval.value=longBreakTimeIntervalValue=settings.longBreakTimeInterval;document.querySelector(`.${localStorage.getItem("currentOption")}`).classList.add("active");alarmRepetition.value=settings.alarmRepetitionCount;selectedAlarmSound=document.querySelector(`#${settings.alarmSound}`);selectedTickingSound=settings.tickingSound?document.querySelector(`#${settings.tickingSound}`):null;alarmSoundsDropDown.firstElementChild.firstElementChild.textContent=selectedAlarmSoundName=settings.alarmSoundName;tickingSoundsDropDown.firstElementChild.firstElementChild.textContent=selectedTickingSoundName=settings.tickingSoundName}function getDefaultSettings(){pomodoroTimeValue.value=pomodoro.dataset.time=25;shortBreakTimeValue.value=shortBreak.dataset.time=5;longBreakTimeValue.value=longBreak.dataset.time=15;autoStartPomodoros.checked=autoStartPomodorosCheck=false;autoStartBreaks.checked=autoStartBreaksCheck=false;darkMode.checked=darkModeCheck=false;longBreakTimeInterval.value=longBreakTimeIntervalValue=4;alarmRepetition.value=0;selectedAlarmSound=defaultAlarm;selectedTickingSound=defaultTicking;alarmSoundsDropDown.firstElementChild.firstElementChild.textContent=selectedAlarmSoundName;tickingSoundsDropDown.firstElementChild.firstElementChild.textContent=selectedTickingSoundName}function closeSettings(){settings.style.height="23%";settings.querySelector(".scroll").style.height="0";settings.firstElementChild.style.boxShadow="none";settings.lastElementChild.style.boxShadow="none";setTimeout(()=>{settingsModal.classList.remove("show")},500)}function dropDownFunc(dropDown,dropDownContent){dropDown.addEventListener("click",e=>{if(e.target.closest("svg")){dropDownContent.classList.toggle("drop");dropDownContent.addEventListener("click",e=>{if(e.target.closest("li")){dropDown.firstElementChild.firstElementChild.textContent=e.target.textContent;[...document.getElementsByTagName("audio")].forEach(audio=>{!audio.paused?audio.pause():""});if(dropDownContent==alarmSounds){selectedAlarmSound=document.getElementById(e.target.dataset.audio)}if(dropDownContent==tickingSounds){selectedTickingSound=document.getElementById(e.target.dataset.audio)}if(dropDown==alarmSoundsDropDown)selectedAlarmSoundName=e.target.textContent;if(dropDown==tickingSoundsDropDown)selectedTickingSoundName=e.target.textContent;selectedSound=document.getElementById(e.target.dataset.audio);if(selectedSound){try{const playPromise=selectedSound.play();if(playPromise!==undefined){playPromise.then(_=>{})}}catch(error){console.error("Error starting media playback:",error)}}dropDownContent.classList.remove("drop")}})}})}startBtn.addEventListener("click",function(){clickSound.play();if(this.className=="start"){document.querySelector(".timer").classList.add("started");if(currentStatus=="focus"){setTimeout(()=>{selectedTickingSound?selectedTickingSound.setAttribute("loop","1"):"";selectedTickingSound?selectedTickingSound.play():""},clickSound.duration*1e3)}setClassAndTexContent("pause",this);startTimer(time);if(darkModeCheck){document.querySelector(".timer").style.backgroundColor="transparent";document.documentElement.style.setProperty("--theme","#000");options[0].parentElement.style.backgroundColor="transparent";options.find(e=>e.classList.contains("active")).classList.add("active_dark")}selectedAlarmSound?selectedAlarmSound.pause():""}else{document.querySelector(".timer").classList.remove("started");setClassAndTexContent("start",this);clearInterval(startInterval);time=timeAtPause/60;document.documentElement.style.setProperty("--theme",timerThemes[currentOption.classList[0]].color);options[0].parentElement.style.backgroundColor="rgba(255, 255, 255, 0.1)";options.find(e=>e.classList.contains("active")).classList.remove("active_dark");selectedTickingSound?selectedTickingSound.pause():""}});options.forEach(e=>{e.addEventListener("click",()=>{document.querySelector(".timer").classList.remove("started");if(startBtn.className=="start"){chooseOption(e)}else{changeOptionModal.classList.add("show");changeOptionModal.addEventListener("click",event=>{if(event.target==changeOptionOkBtn){changeOptionModal.classList.remove("show");chooseOption(e);selectedTickingSound.pause()}else if(event.target==changeOptionCancelBtn){changeOptionModal.classList.remove("show")}})}})});settingOpen.addEventListener("click",()=>{settingsModal.classList.add("show");setTimeout(()=>{settings.style.height="100%";settings.querySelector(".scroll").style.height="80%";settings.firstElementChild.style.boxShadow="-5px 6px 20px #ccc";settings.lastElementChild.style.boxShadow="5px -6px 20px #ccc"},500)});settingsClose.addEventListener("click",()=>closeSettings());settingsSave.addEventListener("click",()=>{clearInterval(startInterval);startBtn.className="start";setClassAndTexContent("start",startBtn);selectedTickingSound?selectedTickingSound.pause():"";document.querySelector(".timer").classList.remove("started");time=time;closeSettings();pomodoro.dataset.time=pomodoroTimeValue.value;shortBreak.dataset.time=shortBreakTimeValue.value;longBreak.dataset.time=longBreakTimeValue.value;longBreakTimeIntervalValue=Math.floor(longBreakTimeInterval.value);displayTimeAndMsg();autoStartBreaks.checked?autoStartBreaksCheck=true:autoStartBreaksCheck=false;autoStartPomodoros.checked?autoStartPomodorosCheck=true:autoStartPomodorosCheck=false;darkMode.checked?darkModeCheck=true:darkModeCheck=false;const savedSettings={pomodoro:pomodoroTimeValue.value,shortBreak:shortBreakTimeValue.value,longBreak:longBreakTimeValue.value,autoStartBreaks:autoStartBreaksCheck,autoStartPomodoros:autoStartPomodorosCheck,longBreakTimeInterval:longBreakTimeIntervalValue,darkMode:darkModeCheck,tickingSound:selectedTickingSound?selectedTickingSound.id:"",alarmSound:selectedAlarmSound.id,alarmRepetitionCount:alarmRepetition.value,alarmSoundName:selectedAlarmSoundName?.trim(),tickingSoundName:selectedTickingSoundName?.trim()};localStorage.setItem("settings",JSON.stringify(savedSettings));if(selectedSound){if(!selectedSound.paused){selectedSound.pause()}}document.documentElement.style.setProperty("--progressBarWidth",`100%`)});settingsReset.addEventListener("click",()=>{resetSettingsModal.classList.add("show");resetSettingsModal.addEventListener("click",event=>{if(event.target==resetSettingsOkBtn){resetSettingsModal.classList.remove("show");closeSettings();getDefaultSettings();displayTimeAndMsg();localStorage.clear();const defaultThemes=["#ba4949","#7d53a2","#38858a"];[...themeColors.children].forEach((e,i)=>{e.style.backgroundColor=defaultThemes[i]});defaultThemes.forEach((theme,i)=>{timerThemes[Object.keys(timerThemes)[i]].color=theme});[...themesChooser.children].forEach(e=>{e.style.backgroundColor=timerThemes[e.classList[0].split("_")[0]].color});document.documentElement.style.setProperty("--theme",timerThemes[currentOption.classList[0]].color)}else if(event.target==resetSettingsCancelBtn){resetSettingsModal.classList.remove("show")}})});[...themesChooser.children].forEach(e=>{e.style.backgroundColor=timerThemes[e.classList[0].split("_")[0]].color});[...themeColors.children].forEach(e=>{e.style.backgroundColor=e.dataset.color});let currentOptionToChangeTheme;themesChooser.addEventListener("click",event=>{const chosenIcon='<i class="fa-solid fa-check"></i>';function getTheChosenColor(theme){const chosen=[...themeColors.children].find(e=>window.getComputedStyle(e).backgroundColor==window.getComputedStyle(theme).backgroundColor);return chosen}const pomodoroChosenColor=getTheChosenColor(pomodoroTheme);const shortBreakChosenColor=getTheChosenColor(shortBreakTheme);const longBreakChosenColor=getTheChosenColor(longBreakTheme);[...themeColors.children].forEach(theme=>{theme.firstElementChild?theme.firstElementChild.remove():""});event.target.className=="pomodoro_theme"?(currentOptionToChangeTheme=pomodoroTheme,currentOptionIndicator.textContent="Pomodoro",pomodoroChosenColor.insertAdjacentHTML("afterbegin",chosenIcon)):event.target.className=="shortBreak_theme"?(currentOptionToChangeTheme=shortBreakTheme,currentOptionIndicator.textContent="Short Break",shortBreakChosenColor.insertAdjacentHTML("afterbegin",chosenIcon)):event.target.className=="longBreak_theme"?(currentOptionToChangeTheme=longBreakTheme,currentOptionIndicator.textContent="Long Break",longBreakChosenColor.insertAdjacentHTML("afterbegin",chosenIcon)):"";themeColorsContainer.classList.add("show");themeColors.addEventListener("click",e=>{if(e.target.hasAttribute("data-color")){currentOptionToChangeTheme.style.backgroundColor=e.target.dataset.color;[...themeColors.children].forEach(theme=>{theme.firstElementChild?theme.firstElementChild.remove():""});e.target.insertAdjacentHTML("afterbegin",chosenIcon);themeColorsContainer.classList.remove("show");let currentTimeThemeObject=Object.entries(timerThemes).find(e=>e[1].theme==currentOptionToChangeTheme.classList[0]);timerThemes[currentTimeThemeObject[0]].color=e.target.dataset.color;localStorage.setItem("timerThemes",JSON.stringify(timerThemes))}})});themeColorsContainer.addEventListener("click",e=>{if(e.target==e.currentTarget)themeColorsContainer.classList.remove("show")});document.addEventListener("click",e=>{if(e.target.closest(".alarm_sounds .dropdown__header")||e.target.closest(".alarm_sounds .dropdown__body"))return;alarmSounds.classList.remove("drop")});document.addEventListener("click",e=>{if(e.target.closest(".ticking_sounds .dropdown__header")||e.target.closest(".ticking_sounds .dropdown__body"))return;tickingSounds.classList.remove("drop")});const numbers=document.querySelectorAll("[type='number']");numbers.forEach(e=>{e.addEventListener("change",()=>{if(e.value<=0){e.value=1;if(e.className=="alarm_repetition"){e.value=0}}})});