"use strict";"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").catch(e=>console.log("service worker not registered",e));let permission=Notification.permission;function showNotification(e,t){if("visible"!==document.visibilityState){const o=new Notification(e,{body:t,icon:"Logo.png"});o.onclick=()=>{o.close(),window.parent.focus()}}}"default"!==permission&&"denied"!==permission||Notification.requestPermission(e=>{});const pomodoro=document.querySelector(".pomodoro"),shortBreak=document.querySelector(".shortBreak"),longBreak=document.querySelector(".longBreak"),displayTimeField=document.querySelector(".timer h1"),startBtn=document.querySelector(".start"),options=[...document.querySelector(".options").children],changeOptionModal=document.querySelector(".changeOption"),closeModal=document.querySelector(".changeOption > div .close"),changeOptionOkBtn=document.querySelector(".changeOption > div .ok"),changeOptionCancelBtn=document.querySelector(".changeOption > div .cancel"),resetSettingsModal=document.querySelector(".resetSettings"),resetSettingsOkBtn=document.querySelector(".resetSettings > div .ok"),resetSettingsCancelBtn=document.querySelector(".resetSettings > div .cancel"),settings=document.querySelector(".settings"),settingsModal=document.querySelector(".settings-container"),settingOpen=document.querySelector(".settings_open"),settingsClose=document.querySelector(".settings-container .close"),settingsSave=document.querySelector(".settings-container .apply"),settingsReset=document.querySelector(".settings-container .reset"),pomodoroTimeValue=document.querySelector(".settings .pomodoro_time"),shortBreakTimeValue=document.querySelector(".settings .shortBreak_time"),longBreakTimeValue=document.querySelector(".settings .longBreak_time"),longBreakTimeInterval=document.querySelector(".longBreak_interval"),autoStartPomodoros=document.querySelector(".autoStartPomodoros"),autoStartBreaks=document.querySelector(".autoStartBreaks"),darkMode=document.querySelector(".darkMode"),themeColorsContainer=document.querySelector(".themeColors"),themesChooser=document.querySelector(".theme_settings .themes"),themeColors=document.querySelector(".themeColors .themes"),pomodoroTheme=document.querySelector(".pomodoro_theme"),shortBreakTheme=document.querySelector(".shortBreak_theme"),longBreakTheme=document.querySelector(".longBreak_theme"),currentOptionIndicator=document.querySelector(".themeColors .current_option"),clickSound=document.getElementById("clickSound"),fastTickingSound=document.getElementById("fastTickingSound"),slowTickingSound=document.getElementById("slowTickingSound"),alarmSoundsDropDown=document.querySelector(".alarm_sounds .dropdown__header"),alarmSounds=document.querySelector(".alarm_sounds .dropdown__body"),alarmRepetition=document.querySelector(".alarm_repetition"),tickingSoundsDropDown=document.querySelector(".ticking_sounds .dropdown__header"),tickingSounds=document.querySelector(".ticking_sounds .dropdown__body"),defaultAlarm=document.getElementById("beepAlarmSound"),defaultTicking=document.getElementById("slowTickingSound");let time,timeAtPause,startInterval,autoStartBreaksCheck,autoStartPomodorosCheck,darkModeCheck,currentOption,selectedSound,selectedAlarmSound,selectedTickingSound,pauseAudio,initialTime,longBreakTimeIntervalValue=+longBreakTimeInterval.value,pomodoroCount=0,currentStatus="focus",displayTimeOnTitle=document.head.querySelector("title"),selectedAlarmSoundName="Beep",selectedTickingSoundName="Slow Ticking";const timerThemes={pomodoro:{theme:"pomodoro_theme",color:"#ba4949"},shortBreak:{theme:"shortBreak_theme",color:"#7d53a2"},longBreak:{theme:"longBreak_theme",color:"#38858a"}};if((localStorage.getItem("settings")?getSettings:getDefaultSettings)(),("pomodoro"!=localStorage.getItem("currentOption")&&localStorage.getItem("currentOption")?"shortBreak"==localStorage.getItem("currentOption")?(currentStatus="shortBreak",document.querySelector(".shortBreak")):(currentStatus="longBreak",document.querySelector(".longBreak")):document.querySelector(".pomodoro")).classList.add("active"),localStorage.getItem("timerThemes")){const h=JSON.parse(localStorage.getItem("timerThemes"));for(const i in h)timerThemes[i]=h[i]}function startTimer(e){let t,o,r;t=60*e;e=()=>{o=parseInt(t/60,10),r=parseInt(t%60,10),o=o<10?"0"+o:o,r=r<10?"0"+r:r,displayTimeField.textContent=o+":"+r,displayTimeOnTitle.textContent=`${o}:${r} - `+getStatus();var e=(timeAtPause=t)/(60*initialTime)*100;if(document.documentElement.style.setProperty("--progressBarWidth",e+"%"),--t<0)if(clearInterval(startInterval),setClassAndTexContent("start",startBtn),"focus"==currentStatus){let e,t=(pomodoroCount=++pomodoroCount==longBreakTimeIntervalValue?(e=".longBreak",0):(e=".shortBreak",pomodoroCount),document.querySelector(e).dispatchEvent(new Event("click")),+alarmRepetition.value);selectedAlarmSound.addEventListener("ended",function(){0<t?(t--,this.currentTime=0,this.play()):t--}),selectedAlarmSound.play(),autoStartBreaksCheck&&selectedAlarmSound.addEventListener("ended",()=>{-1===t&&startBtn.dispatchEvent(new Event("click"))}),selectedTickingSound.pause(),showNotification("Time's up!","Time's up! Take a break!")}else document.querySelector(".pomodoro").dispatchEvent(new Event("click")),autoStartPomodorosCheck&&startBtn.dispatchEvent(new Event("click")),showNotification("Time to focus!","Break time is over! Focus now!")};e(),startInterval=setInterval(e,1e3)}function displayTimeAndMsg(){currentOption=options.find(e=>e.classList.contains("active")),localStorage.setItem("currentOption",currentOption.classList[0]),initialTime=time=currentOption.dataset.time;var e=(time<10?"0":"")+time+":00",t="00:"+(60*time<10?"0":"")+60*time;displayTimeField.textContent=1<=time?e:t,displayTimeOnTitle.textContent=`${1<=time?e:t} - `+getStatus(),document.documentElement.style.setProperty("--theme",timerThemes[currentOption.classList[0]].color)}function getStatus(){let e;return e="focus"==currentStatus?"Time to focus!":"shortBreak"==currentStatus?"Time for a short break!":"Time for a long break!"}dropDownFunc(alarmSoundsDropDown,alarmSounds),dropDownFunc(tickingSoundsDropDown,tickingSounds),displayTimeAndMsg();const setClassAndTexContent=(e,t)=>{t.textContent=e.toUpperCase(),t.className=e};function chooseOption(e){options.forEach(e=>e.className=e.classList[0]),e.classList.add("active"),currentStatus="pomodoro"==e.classList[0]?"focus":currentStatus="shortBreak"==e.classList[0]?"shortBreak":"longBreak",clearInterval(startInterval),setClassAndTexContent("start",startBtn),displayTimeAndMsg(),document.documentElement.style.setProperty("--progressBarWidth","100%"),selectedAlarmSound&&selectedAlarmSound.pause()}function getSettings(){var e=JSON.parse(localStorage.getItem("settings"));pomodoroTimeValue.value=pomodoro.dataset.time=e.pomodoro,shortBreakTimeValue.value=shortBreak.dataset.time=e.shortBreak,longBreakTimeValue.value=longBreak.dataset.time=e.longBreak,autoStartPomodoros.checked=autoStartPomodorosCheck=e.autoStartPomodoros,autoStartBreaks.checked=autoStartBreaksCheck=e.autoStartBreaks,darkMode.checked=darkModeCheck=e.darkMode,longBreakTimeInterval.value=longBreakTimeIntervalValue=e.longBreakTimeInterval,document.querySelector("."+localStorage.getItem("currentOption")).classList.add("active"),alarmRepetition.value=e.alarmRepetitionCount,selectedAlarmSound=document.querySelector("#"+e.alarmSound),selectedTickingSound=e.tickingSound?document.querySelector("#"+e.tickingSound):null,alarmSoundsDropDown.firstElementChild.firstElementChild.textContent=selectedAlarmSoundName=e.alarmSoundName,tickingSoundsDropDown.firstElementChild.firstElementChild.textContent=selectedTickingSoundName=e.tickingSoundName}function getDefaultSettings(){pomodoroTimeValue.value=pomodoro.dataset.time=25,shortBreakTimeValue.value=shortBreak.dataset.time=5,longBreakTimeValue.value=longBreak.dataset.time=15,autoStartPomodoros.checked=autoStartPomodorosCheck=!1,autoStartBreaks.checked=autoStartBreaksCheck=!1,darkMode.checked=darkModeCheck=!1,longBreakTimeInterval.value=longBreakTimeIntervalValue=4,alarmRepetition.value=0,selectedAlarmSound=defaultAlarm,selectedTickingSound=defaultTicking,alarmSoundsDropDown.firstElementChild.firstElementChild.textContent=selectedAlarmSoundName,tickingSoundsDropDown.firstElementChild.firstElementChild.textContent=selectedTickingSoundName}function closeSettings(){settings.style.height="23%",settings.querySelector(".scroll").style.height="0",settings.firstElementChild.style.boxShadow="none",settings.lastElementChild.style.boxShadow="none",setTimeout(()=>{settingsModal.classList.remove("show")},500)}function dropDownFunc(o,r){o.addEventListener("click",e=>{e.target.closest("svg")&&(r.classList.toggle("drop"),r.addEventListener("click",e=>{if(e.target.closest("li")){if(o.firstElementChild.firstElementChild.textContent=e.target.textContent,[...document.getElementsByTagName("audio")].forEach(e=>{e.paused||e.pause()}),r==alarmSounds&&(selectedAlarmSound=document.getElementById(e.target.dataset.audio)),r==tickingSounds&&(selectedTickingSound=document.getElementById(e.target.dataset.audio)),o==alarmSoundsDropDown&&(selectedAlarmSoundName=e.target.textContent),o==tickingSoundsDropDown&&(selectedTickingSoundName=e.target.textContent),selectedSound=document.getElementById(e.target.dataset.audio))try{var t=selectedSound.play();void 0!==t&&t.then(e=>{})}catch(e){console.error("Error starting media playback:",e)}r.classList.remove("drop")}}))})}startBtn.addEventListener("click",function(){clickSound.play(),"start"==this.className?(document.querySelector(".timer").classList.add("started"),"focus"==currentStatus&&setTimeout(()=>{selectedTickingSound&&selectedTickingSound.setAttribute("loop","1"),selectedTickingSound&&selectedTickingSound.play()},1e3*clickSound.duration),setClassAndTexContent("pause",this),startTimer(time),darkModeCheck&&(document.querySelector(".timer").style.backgroundColor="transparent",document.documentElement.style.setProperty("--theme","#000"),options[0].parentElement.style.backgroundColor="transparent",options.find(e=>e.classList.contains("active")).classList.add("active_dark")),selectedAlarmSound&&selectedAlarmSound.pause()):(document.querySelector(".timer").classList.remove("started"),setClassAndTexContent("start",this),clearInterval(startInterval),time=timeAtPause/60,document.documentElement.style.setProperty("--theme",timerThemes[currentOption.classList[0]].color),options[0].parentElement.style.backgroundColor="rgba(255, 255, 255, 0.1)",options.find(e=>e.classList.contains("active")).classList.remove("active_dark"),selectedTickingSound&&selectedTickingSound.pause())}),options.forEach(t=>{t.addEventListener("click",()=>{document.querySelector(".timer").classList.remove("started"),"start"==startBtn.className?chooseOption(t):(changeOptionModal.classList.add("show"),changeOptionModal.addEventListener("click",e=>{e.target==changeOptionOkBtn?(changeOptionModal.classList.remove("show"),chooseOption(t),selectedTickingSound.pause()):e.target==changeOptionCancelBtn&&changeOptionModal.classList.remove("show")}))})}),settingOpen.addEventListener("click",()=>{settingsModal.classList.add("show"),setTimeout(()=>{settings.style.height="100%",settings.querySelector(".scroll").style.height="80%",settings.firstElementChild.style.boxShadow="-5px 6px 20px #ccc",settings.lastElementChild.style.boxShadow="5px -6px 20px #ccc"},500)}),settingsClose.addEventListener("click",()=>closeSettings()),settingsSave.addEventListener("click",()=>{clearInterval(startInterval),startBtn.className="start",setClassAndTexContent("start",startBtn),selectedTickingSound&&selectedTickingSound.pause(),document.querySelector(".timer").classList.remove("started"),time=time,closeSettings(),pomodoro.dataset.time=pomodoroTimeValue.value,shortBreak.dataset.time=shortBreakTimeValue.value,longBreak.dataset.time=longBreakTimeValue.value,longBreakTimeIntervalValue=Math.floor(longBreakTimeInterval.value),displayTimeAndMsg(),autoStartBreaksCheck=!!autoStartBreaks.checked,autoStartPomodorosCheck=!!autoStartPomodoros.checked,darkModeCheck=!!darkMode.checked;var e={pomodoro:pomodoroTimeValue.value,shortBreak:shortBreakTimeValue.value,longBreak:longBreakTimeValue.value,autoStartBreaks:autoStartBreaksCheck,autoStartPomodoros:autoStartPomodorosCheck,longBreakTimeInterval:longBreakTimeIntervalValue,darkMode:darkModeCheck,tickingSound:selectedTickingSound?selectedTickingSound.id:"",alarmSound:selectedAlarmSound.id,alarmRepetitionCount:alarmRepetition.value,alarmSoundName:selectedAlarmSoundName?.trim(),tickingSoundName:selectedTickingSoundName?.trim()};localStorage.setItem("settings",JSON.stringify(e)),selectedSound&&!selectedSound.paused&&selectedSound.pause(),document.documentElement.style.setProperty("--progressBarWidth","100%")}),settingsReset.addEventListener("click",()=>{resetSettingsModal.classList.add("show"),resetSettingsModal.addEventListener("click",e=>{if(e.target==resetSettingsOkBtn){resetSettingsModal.classList.remove("show"),closeSettings(),getDefaultSettings(),displayTimeAndMsg(),localStorage.clear();const o=["#ba4949","#7d53a2","#38858a"];[...themeColors.children].forEach((e,t)=>{e.style.backgroundColor=o[t]}),o.forEach((e,t)=>{timerThemes[Object.keys(timerThemes)[t]].color=e}),[...themesChooser.children].forEach(e=>{e.style.backgroundColor=timerThemes[e.classList[0].split("_")[0]].color}),document.documentElement.style.setProperty("--theme",timerThemes[currentOption.classList[0]].color)}else e.target==resetSettingsCancelBtn&&resetSettingsModal.classList.remove("show")})}),[...themesChooser.children].forEach(e=>{e.style.backgroundColor=timerThemes[e.classList[0].split("_")[0]].color}),[...themeColors.children].forEach(e=>{e.style.backgroundColor=e.dataset.color});let currentOptionToChangeTheme;themesChooser.addEventListener("click",e=>{const o='<i class="fa-solid fa-check"></i>';function t(t){return[...themeColors.children].find(e=>window.getComputedStyle(e).backgroundColor==window.getComputedStyle(t).backgroundColor)}var r=t(pomodoroTheme),n=t(shortBreakTheme),a=t(longBreakTheme);[...themeColors.children].forEach(e=>{e.firstElementChild&&e.firstElementChild.remove()}),"pomodoro_theme"==e.target.className?(currentOptionToChangeTheme=pomodoroTheme,currentOptionIndicator.textContent="Pomodoro",r.insertAdjacentHTML("afterbegin",o)):"shortBreak_theme"==e.target.className?(currentOptionToChangeTheme=shortBreakTheme,currentOptionIndicator.textContent="Short Break",n.insertAdjacentHTML("afterbegin",o)):"longBreak_theme"==e.target.className&&(currentOptionToChangeTheme=longBreakTheme,currentOptionIndicator.textContent="Long Break",a.insertAdjacentHTML("afterbegin",o)),themeColorsContainer.classList.add("show"),themeColors.addEventListener("click",e=>{var t;e.target.hasAttribute("data-color")&&(currentOptionToChangeTheme.style.backgroundColor=e.target.dataset.color,[...themeColors.children].forEach(e=>{e.firstElementChild&&e.firstElementChild.remove()}),e.target.insertAdjacentHTML("afterbegin",o),themeColorsContainer.classList.remove("show"),t=Object.entries(timerThemes).find(e=>e[1].theme==currentOptionToChangeTheme.classList[0]),timerThemes[t[0]].color=e.target.dataset.color,localStorage.setItem("timerThemes",JSON.stringify(timerThemes)))})}),themeColorsContainer.addEventListener("click",e=>{e.target==e.currentTarget&&themeColorsContainer.classList.remove("show")}),document.addEventListener("click",e=>{e.target.closest(".alarm_sounds .dropdown__header")||e.target.closest(".alarm_sounds .dropdown__body")||alarmSounds.classList.remove("drop")}),document.addEventListener("click",e=>{e.target.closest(".ticking_sounds .dropdown__header")||e.target.closest(".ticking_sounds .dropdown__body")||tickingSounds.classList.remove("drop")});const numbers=document.querySelectorAll("[type='number']");numbers.forEach(e=>{e.addEventListener("change",()=>{e.value<=0&&(e.value=1,"alarm_repetition"==e.className)&&(e.value=0)})});